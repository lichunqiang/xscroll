define(function(t,n,e){"use strict";var i,r=t("../util"),s=t("../base"),l="Loading...",o="Pull Up To Refresh",u="Release To Refresh",a=60,c=40,h=function(t){h.superclass.constructor.call(this),this.userConfig=r.mix({upContent:o,downContent:u,pullUpHeight:a,height:c,loadingContent:l,bufferHeight:0,clsPrefix:"xs-plugin-pullup-"},t)};if(r.extend(h,s,{pluginId:"pullup",pluginInitializer:function(t){var n=this;return n.xscroll=t.render(),i=n.userConfig.clsPrefix,n.render(),n},pluginDestructor:function(){var t=this;r.remove(t.pullup),t.xscroll.off("scrollend",t._scrollEndHandler,t),t.xscroll.off("scroll",t._scrollHandler,t),t.xscroll.off("pan",t._panHandler,t),t.xscroll.boundry.resetBottom(),t.__isRender=!1,t._evtBinded=!1},render:function(){var t=this;if(!t.__isRender){if(t.__isRender=!0,t.userConfig.container)t.pullup=t.userConfig.container;else{var n=i+"container",e=t.userConfig.height,s=t.pullup=document.createElement("div");s.className=n,s.style.position="absolute",s.style.width="100%",s.style.height=e+"px",s.style.bottom=-e+"px",s.style.textAlign="center",t.xscroll.container.appendChild(s),r.addClass(s,i+t.status),s.innerHTML=t.userConfig[t.status+"Content"]||t.userConfig.content}return t.xscroll.boundry.expandBottom(t.userConfig.height),t.status="up",t._bindEvt(),t}},_bindEvt:function(){var t=this;if(!t._evtBinded){t._evtBinded=!0;var n=(t.pullup,t.xscroll);return n.on("pan",t._panHandler,t),t.userConfig.bufferHeight>0&&n.on("scroll",t._scrollHandler,t),n.on("scrollend",t._scrollEndHandler,t),t}},_scrollEndHandler:function(t){var n=this,e=n.xscroll,i=e.getScrollTop();return i==e.containerHeight-e.height+n.userConfig.height&&n._changeStatus("loading"),n},_scrollHandler:function(t){var n=this,e=n.xscroll;return!n.isLoading&&Math.abs(t.scrollTop)+e.height+n.userConfig.height+n.userConfig.bufferHeight>=e.containerHeight+e.boundry._xtop+e.boundry._xbottom&&n._changeStatus("loading"),n},_panHandler:function(t){var n=this,e=n.xscroll,i=-e.getScrollTop();return i<e.height-e.containerHeight-n.userConfig.pullUpHeight?n._changeStatus("down"):n._changeStatus("up"),n},_changeStatus:function(t){if("loading"==t||!this.isLoading){var n=this.status;return this.status=t,this.userConfig.container||(r.removeClass(this.pullup,i+n),r.addClass(this.pullup,i+t),this.pullup.innerHTML=this.userConfig[t+"Content"]),n!=t&&(this.trigger("statuschange",{prevVal:n,newVal:t}),"loading"==t&&(this.isLoading=!0,this.trigger("loading"))),this}},complete:function(){var t=this;t.xscroll;return t.isLoading=!1,t._changeStatus("up"),t},stop:function(){this.xscroll;return this.isLoading=!1,this._changeStatus("stop"),this.pluginDestructor(),this},restart:function(){this.xscroll;return this.isLoading=!1,this._changeStatus("default"),this.render(),this}}),"object"==typeof e&&e.exports)e.exports=h;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.PullUp=h});